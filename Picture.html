<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="Gallery.css">
  <title>Gallery</title>
</head>
<body>
  <header>
    <div class="navbar">
      <div class="logo"><a href="#">Our School Days.</a></div>
      <ul class="links">
        <li><a href="home.html">Home</a></li>
        <li><a href="About.html">About</a></li>
        <li><a href="Picture.html" class="active">Pictures</a></li>
        <li><a href="Recap.html">Recap </a></li>        
      </ul>
    </div>
  </header>

<div class="pics">

  <h1 class="title">PICTURES</h1>

  <div id="uploadSection">
    <label for="uploadInput" class="custom-file-button">choose nice pics</label>
    <input type="file" id="uploadInput" accept="image/*" multiple class="choose" style="display: none;">
    <button id="uploadBtn" class="upload">Upload Images</button>
  </div>
  
  <!-- Gallery Container -->
  <div id="gallery"></div>

   <!-- Lightbox -->
  <div id="lightbox">
    <span id="closeBtn">&times;</span>
    <button id="prevBtn" class="lightbox-btn">&#10094;</button>
    <img id="lightboxImg">
    <button id="nextBtn" class="lightbox-btn">&#10095;</button>
  </div>
  
  
  <script>
    const API_URL = "http://localhost:5000";
    const gallery = document.getElementById("gallery");
    let imagesArray = [];
    let currentIndex = 0;

    function loadImages() {
        fetch(`${API_URL}/images`)
            .then(response => response.json())
            .then(images => {
                imagesArray = images;
                gallery.innerHTML = "";
                images.forEach((img, index) => addImage(`${API_URL}${img}`, img, index));
            });
    }

    function addImage(src, filename, index) {
        let item = document.createElement("div");
        item.classList.add("gallery-item");

        let imgElement = document.createElement("img");
        imgElement.src = src;
        imgElement.classList.add("gallery-img");
        imgElement.setAttribute("data-index", index);
        imgElement.addEventListener("click", openLightbox);

        let deleteBtn = document.createElement("button");
        deleteBtn.innerText = "âœ–";
        deleteBtn.classList.add("delete-btn");
        deleteBtn.addEventListener("click", () => deleteImage(filename, item));

        item.appendChild(imgElement);
        item.appendChild(deleteBtn);
        gallery.appendChild(item);
    }

    function deleteImage(filename, item) {
        fetch(`${API_URL}/delete`, {
            method: "DELETE",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ filename: filename.split("/").pop() })
        }).then(response => response.json())
          .then(data => {
              if (data.success) item.remove();
          });
    }

    function openLightbox(event) {
        currentIndex = parseInt(event.target.getAttribute("data-index"));
        updateLightboxImage();
        document.getElementById("lightbox").style.display = "flex";
    }

    function updateLightboxImage() {
        document.getElementById("lightboxImg").src = `${API_URL}${imagesArray[currentIndex]}`;
    }

     // Close Lightbox
     document.getElementById("closeBtn").addEventListener("click", () => {
            document.getElementById("lightbox").style.display = "none";
        });

        // Next Image
        document.getElementById("nextBtn").addEventListener("click", () => {
            currentIndex = (currentIndex + 1) % imagesArray.length;
            updateLightboxImage();
        });

        // Previous Image
        document.getElementById("prevBtn").addEventListener("click", () => {
            currentIndex = (currentIndex - 1 + imagesArray.length) % imagesArray.length;
            updateLightboxImage();
        });

        // Upload functionality
document.getElementById('uploadBtn').addEventListener('click', () => {
    const input = document.getElementById('uploadInput');
    if (input.files.length === 0) {
        alert('Please select at least one image');
        return;
    }

    const formData = new FormData();
    for (let i = 0; i < input.files.length; i++) {
        formData.append('images', input.files[i]);
    }

    fetch(`${API_URL}/upload`, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Reload images after upload
            loadImages();
            // Clear the file input
            input.value = '';
            alert('Images uploaded successfully!');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error uploading images');
    });
});

    loadImages();
  </script>
</div>
</body>
</html>